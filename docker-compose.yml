puppet:
  restart: unless-stopped
  container_name: puppetserver
  hostname: puppet
  image: opsforge/puppetserver
  ports:
    - 8140
  volumes:
    - ./code:/etc/puppetlabs/code/
    - ./puppet/ssl:/etc/puppetlabs/puppet/ssl/
    - ./puppet/serverdata:/opt/puppetlabs/server/data/puppetserver/
  links:
    - puppetdb:puppetdb

puppetdbpostgres:
  restart: unless-stopped
  container_name: puppetdb-psql
  image: opsforge/puppetdb-psql
  environment:
    - POSTGRES_PASSWORD=puppetdb
    - POSTGRES_USER=puppetdb
  expose:
    - 5432
  volumes:
    - ./puppetdb-postgres/data:/var/lib/postgresql/data/

puppetdb:
  restart: unless-stopped
  hostname: puppetdb
  image: opsforge/puppetdb
  expose:
    - 8080
    - 8081
  volumes:
    - ./puppetdb/ssl:/etc/puppetlabs/puppet/ssl/
  links:
    - puppetdbpostgres:postgres

puppetboard:
  restart: unless-stopped
  image: opsforge/puppetboard
  environment:
    - PUPPETDB_HOST=puppetdb
    - PUPPETDB_PORT=8081
    - PUPPETDB_SSL_VERIFY=False
    - INVENTORY_FACTS='Hostname,fqdn, IP Address,ipaddress'
    - ENABLE_CATALOG=true
    - GRAPH_FACTS='architecture,puppetversion,osfamily'
  ports:
    - 9080:80
  links:
    - puppetdb:puppetdb
